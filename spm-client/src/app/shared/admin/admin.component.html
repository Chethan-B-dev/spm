<link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
  rel="stylesheet"
  integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
  crossorigin="anonymous"
/>

<div class="container py-3">
  <div class="left-and-right">
    <div>
      <h4 class="inline-block" style="display: inline-block; padding: 15px">
        Users
      </h4>
      <mat-form-field>
        <mat-label>Select User Status</mat-label>
        <mat-select
          [(value)]="defaultUserCategory"
          (selectionChange)="onUserCategoryChange($event.value)"
        >
          <mat-option value="UNVERIFIED" selected>Pending Users</mat-option>
          <mat-option value="ALL">All Users</mat-option>
          <mat-option value="VERIFIED">Verified Users</mat-option>
          <mat-option value="DISABLED">Disabled Users</mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <mat-form-field
      class="example-full-width mr-4"
      appearance="fill"
      [style.width.px]="320"
    >
      <mat-label>Search User By username or email or role</mat-label>
      <input
        type="search"
        matInput
        placeholder="Search users"
        (input)="searchUser($event.target.value)"
      />
    </mat-form-field>
  </div>

  <div class="row" *ngIf="users$ | async as users">
    <div class="col-md-4 col-sm-6 col-xs-12" *ngFor="let user of users">
      <mat-card class="example-card">
        <div class="left-and-right">
          <div class="intro-header">
            <div class="inner-header">
              <mat-card-title
                ><span
                  [matBadge]="user.status === 'VERIFIED' ? 'check' : 'close'"
                  [matBadgeColor]="
                    user.status === 'VERIFIED' ? 'primary' : 'warn'
                  "
                  [matTooltip]="user.status | titlecase"
                  matBadgeOverlap="false"
                  >{{ user.username }}</span
                >
              </mat-card-title>
              <mat-card-subtitle>{{ user.role | titlecase }}</mat-card-subtitle>
            </div>
          </div>
          <!-- todo: send the id to delete to the modal later -->
          <button mat-mat-icon-button (click)="openDeleteConfirmDialog()">
            <mat-icon>delete</mat-icon>
          </button>
        </div>

        <mat-divider></mat-divider>

        <mat-card-actions class="push-to-right">
          <button
            mat-raised-button
            color="primary"
            [disabled]="
              user.status === 'VERIFIED' || user.status === 'DISABLED'
            "
            (click)="takeDecision(user.id, 'APPROVE')"
          >
            Approve
          </button>
          <button
            mat-raised-button
            color="warn"
            [disabled]="
              user.status === 'UNVERIFIED' || user.status === 'DISABLED'
            "
            (click)="takeDecision(user.id, 'REJECT')"
          >
            Reject
          </button>

          <button
            mat-raised-button
            color="accent"
            *ngIf="user.status === 'DISABLED'"
            (click)="enableUser(user.id)"
          >
            Enable
          </button>
        </mat-card-actions>
      </mat-card>
    </div>

    <div *ngIf="users.length === 0">
      <mat-card>No users to display</mat-card>
    </div>
  </div>

  <div class="center loading-screen" *ngIf="isLoading$ | async">
    <app-loading-spinner color="accent"></app-loading-spinner>
  </div>
</div>
